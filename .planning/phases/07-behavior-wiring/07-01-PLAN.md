---
phase: 07-behavior-wiring
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/analysis/llm/prompt-builder.ts
  - __tests__/unit/analysis/llm/prompt-builder.test.ts
  - __tests__/unit/core/intensity.test.ts
autonomous: true

must_haves:
  truths:
    - "Thorough intensity generates comprehensive analysis instructions"
    - "Standard intensity matches current production behavior"
    - "Light intensity generates quick-scan instructions"
    - "All prompt variations include file list and diff"
  artifacts:
    - path: "src/analysis/llm/prompt-builder.ts"
      provides: "Intensity-aware prompt generation"
      contains: "getInstructionsByIntensity"
    - path: "__tests__/unit/analysis/llm/prompt-builder.test.ts"
      provides: "Prompt variation tests"
      contains: "COMPREHENSIVE"
  key_links:
    - from: "src/analysis/llm/prompt-builder.ts"
      to: "ReviewIntensity type"
      via: "switch statement"
      pattern: "case 'thorough'"
---

<objective>
Implement intensity-aware prompt generation in PromptBuilder using TDD.

Purpose: PromptBuilder currently accepts intensity parameter but generates identical instructions for all intensities. This plan adds switch-based instruction variation so thorough/standard/light intensities generate appropriately detailed or brief prompts.

Output: PromptBuilder.build() generates visibly different prompts for each intensity level, with tests proving the variations.
</objective>

<execution_context>
@/Users/keith/.claude/get-shit-done/workflows/execute-plan.md
@/Users/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-behavior-wiring/07-RESEARCH.md

Reference files:
@src/analysis/llm/prompt-builder.ts
@__tests__/unit/analysis/llm/prompt-builder.test.ts
@__tests__/unit/core/intensity.test.ts
</context>

<feature>
  <name>Intensity-aware prompt generation</name>
  <files>src/analysis/llm/prompt-builder.ts, __tests__/unit/analysis/llm/prompt-builder.test.ts, __tests__/unit/core/intensity.test.ts</files>
  <behavior>
    PromptBuilder.build() should generate different instructions based on intensity:

    THOROUGH:
    - "COMPREHENSIVE analysis" in instructions
    - Include edge case checking instructions
    - Include detailed reasoning requirements
    - Include boundary condition analysis
    - Prompt should be longer than standard

    STANDARD (current behavior):
    - "ONLY report actual bugs" remains unchanged
    - Current CRITICAL RULES remain unchanged
    - This is the baseline - no new text

    LIGHT:
    - "QUICK scan" in instructions
    - "ONLY report CRITICAL issues" (crashes, data loss, security)
    - Skip style, performance, architecture
    - "Brief findings only" instruction
    - Prompt should be shorter than standard

    Test cases:
    - build(pr, intensity='thorough') → contains "COMPREHENSIVE"
    - build(pr, intensity='standard') → matches current behavior exactly
    - build(pr, intensity='light') → contains "QUICK scan"
    - All intensities include file list and diff
    - Exhaustiveness check: adding new intensity causes TypeScript error
  </behavior>
  <implementation>
    1. Add private getInstructionsByIntensity(): string[] method with switch statement
    2. Move existing instructions to 'standard' case
    3. Add 'thorough' case with comprehensive instructions
    4. Add 'light' case with brief instructions
    5. Add exhaustiveness check in default case using never type
    6. Update build() to call getInstructionsByIntensity() instead of inline array
  </implementation>
</feature>

<verification>
```bash
# Run prompt builder tests
npm test -- --testPathPattern="prompt-builder" --verbose

# Run intensity tests
npm test -- --testPathPattern="intensity" --verbose

# Verify TypeScript compiles (catches exhaustiveness issues)
npx tsc --noEmit
```
</verification>

<success_criteria>
- Tests verify thorough prompts contain "COMPREHENSIVE" or similar distinctive text
- Tests verify standard prompts match current production behavior
- Tests verify light prompts contain "QUICK" or "CRITICAL issues only" distinctive text
- Tests verify all intensities include file list and diff
- TypeScript compiles without errors (exhaustiveness check works)
- Existing prompt-builder tests continue to pass
</success_criteria>

<output>
After completion, create `.planning/phases/07-behavior-wiring/07-01-SUMMARY.md`
</output>
