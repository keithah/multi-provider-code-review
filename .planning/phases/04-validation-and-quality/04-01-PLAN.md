---
phase: 04-validation-and-quality
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/validation/syntax-validator.ts
  - __tests__/validation/syntax-validator.test.ts
autonomous: true

must_haves:
  truths:
    - "Valid TypeScript code passes syntax validation"
    - "Invalid syntax (ERROR nodes) fails validation"
    - "Missing tokens (MISSING nodes) fail validation"
    - "Unsupported languages return skip result (not failure)"
  artifacts:
    - path: "src/validation/syntax-validator.ts"
      provides: "validateSyntax function"
      exports: ["validateSyntax", "SyntaxValidationResult"]
    - path: "__tests__/validation/syntax-validator.test.ts"
      provides: "Syntax validator tests"
      contains: "describe.*syntax"
  key_links:
    - from: "src/validation/syntax-validator.ts"
      to: "tree-sitter"
      via: "parser.parse"
      pattern: "parser\\.parse"
---

<objective>
TDD implementation of syntax validation using tree-sitter for code suggestions.

Purpose: Validate suggested code fixes have valid syntax before posting to GitHub. Invalid suggestions silently degrade to description-only (per CONTEXT.md decision).

Output: Working `validateSyntax` function with comprehensive test coverage for TypeScript, JavaScript, Python, and Go.
</objective>

<execution_context>
@/Users/keith/.claude/get-shit-done/workflows/execute-plan.md
@/Users/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-validation-and-quality/04-CONTEXT.md
@.planning/phases/04-validation-and-quality/04-RESEARCH.md
@src/analysis/ast/parsers.ts
</context>

<feature>
  <name>Syntax Validator</name>
  <files>src/validation/syntax-validator.ts, __tests__/validation/syntax-validator.test.ts</files>
  <behavior>
    validateSyntax(code: string, language: Language) -> SyntaxValidationResult

    Cases:
    - Valid TypeScript: `const x: number = 42;` -> { isValid: true, errors: [] }
    - ERROR node: `const x: number = 42 const y` -> { isValid: false, errors: [{type: 'ERROR', ...}] }
    - MISSING node: `function foo() { const x = 1` -> { isValid: false, errors: [{type: 'MISSING', ...}] }
    - Valid Python: `def foo(): pass` -> { isValid: true, errors: [] }
    - Invalid Python: `def foo(` -> { isValid: false, errors: [...] }
    - Unknown language: (language: 'unknown') -> { isValid: true, skipped: true, reason: 'Unsupported language' }
    - Parser unavailable: (grammar not installed) -> { isValid: true, skipped: true, reason: 'Parser not available' }

    CRITICAL: Must check BOTH node.type === 'ERROR' AND node.isMissing
    - ERROR nodes: unparseable text (syntax errors)
    - MISSING nodes: parser-inserted recovery tokens (unclosed braces, missing semicolons)
    - Only checking hasError misses MISSING nodes!
  </behavior>
  <implementation>
    1. Reuse getParser from src/analysis/ast/parsers.ts (already handles grammar loading)
    2. Parse code with tree-sitter
    3. Walk tree checking for ERROR and MISSING nodes
    4. Return structured result with error locations

    Interface:
    ```typescript
    interface SyntaxValidationResult {
      isValid: boolean;
      skipped?: boolean;     // true if language unsupported or parser unavailable
      reason?: string;       // why skipped
      errors: Array<{
        type: 'ERROR' | 'MISSING';
        line: number;        // 1-indexed
        column: number;      // 1-indexed
        text?: string;       // node text for debugging
      }>;
    }
    ```
  </implementation>
</feature>

<verification>
```bash
npm test -- --testPathPattern="syntax-validator" --verbose
```
All tests pass. Coverage includes:
- Valid code (all supported languages)
- ERROR nodes (syntax errors)
- MISSING nodes (recovery tokens)
- Unsupported language handling
- Parser unavailable handling
</verification>

<success_criteria>
- RED: Tests fail because validateSyntax doesn't exist
- GREEN: Tests pass with minimal implementation
- REFACTOR: Clean up, export types from index.ts
- All 4 supported languages tested (TypeScript, JavaScript, Python, Go)
- Both ERROR and MISSING nodes detected
</success_criteria>

<output>
After completion, create `.planning/phases/04-validation-and-quality/04-01-SUMMARY.md`
</output>
