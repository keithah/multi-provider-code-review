---
phase: 06-configuration-a-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/config/schema.ts
  - src/types/index.ts
  - src/config/defaults.ts
autonomous: true

must_haves:
  truths:
    - "intensityConsensusThresholds is a valid config option with per-intensity percentages"
    - "intensitySeverityFilters is a valid config option with per-intensity severity levels"
    - "TypeScript compilation succeeds with new config fields"
  artifacts:
    - path: "src/config/schema.ts"
      provides: "Zod schema for intensity_consensus_thresholds and intensity_severity_filters"
      contains: "intensity_consensus_thresholds"
    - path: "src/types/index.ts"
      provides: "TypeScript interfaces for new intensity config fields"
      contains: "intensityConsensusThresholds"
    - path: "src/config/defaults.ts"
      provides: "Default values for intensity consensus and severity mappings"
      contains: "intensityConsensusThresholds"
  key_links:
    - from: "src/config/schema.ts"
      to: "src/types/index.ts"
      via: "type definition matching schema"
      pattern: "intensityConsensusThresholds.*thorough.*standard.*light"
---

<objective>
Extend configuration schema with intensity-based consensus thresholds and severity filters.

Purpose: Phase 6 requires intensity behavior mappings (consensus thresholds, severity filters) to be configurable. This plan adds the schema, types, and defaults for these new configuration fields.

Output: Extended schema.ts, types/index.ts, and defaults.ts with two new intensity behavior mappings.
</objective>

<execution_context>
@/Users/keith/.claude/get-shit-done/workflows/execute-plan.md
@/Users/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-configuration-a-validation/06-CONTEXT.md
@.planning/phases/06-configuration-a-validation/06-RESEARCH.md

@src/config/schema.ts
@src/types/index.ts
@src/config/defaults.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend Zod Schema with Intensity Behavior Fields</name>
  <files>src/config/schema.ts</files>
  <action>
Add two new fields to ReviewConfigSchema following the existing pattern for intensity mappings (see lines 88-102):

1. `intensity_consensus_thresholds` - Per-intensity consensus percentage thresholds
   ```typescript
   intensity_consensus_thresholds: z.object({
     thorough: z.number().min(0).max(100),
     standard: z.number().min(0).max(100),
     light: z.number().min(0).max(100),
   }).optional(),
   ```

2. `intensity_severity_filters` - Per-intensity minimum severity for inline comments
   ```typescript
   intensity_severity_filters: z.object({
     thorough: z.enum(['critical', 'major', 'minor']),
     standard: z.enum(['critical', 'major', 'minor']),
     light: z.enum(['critical', 'major', 'minor']),
   }).optional(),
   ```

Add these after the existing `intensity_prompt_depth` field (around line 102) to keep intensity-related config grouped together.

Note: Use `min(0).max(100)` for percentages - the clamping with warning will be added in Plan 02's validation layer, not at schema level (schema should accept raw values, validation layer handles clamping).
  </action>
  <verify>Run `npm run build` - TypeScript compiles without errors</verify>
  <done>ReviewConfigSchema includes intensity_consensus_thresholds and intensity_severity_filters fields</done>
</task>

<task type="auto">
  <name>Task 2: Add TypeScript Interface Fields</name>
  <files>src/types/index.ts</files>
  <action>
Add the corresponding TypeScript interface fields to ReviewConfig interface. Add after the existing `intensityPromptDepth` field (around line 120):

```typescript
/** Per-intensity consensus threshold percentages (0-100). Higher = more agreement required. */
intensityConsensusThresholds?: {
  /** Thorough review: require 80% provider agreement (default: 80) */
  thorough: number;
  /** Standard review: require 60% provider agreement (default: 60) */
  standard: number;
  /** Light review: require 40% provider agreement (default: 40) */
  light: number;
};

/** Per-intensity minimum severity for inline comments. Lower = more issues shown. */
intensitySeverityFilters?: {
  /** Thorough review: show all severities including minor (default: 'minor') */
  thorough: Severity;
  /** Standard review: show minor and above (default: 'minor') */
  standard: Severity;
  /** Light review: show only major and critical (default: 'major') */
  light: Severity;
};
```

Include JSDoc comments per CONTEXT.md decision (both JSDoc AND example files for documentation).
  </action>
  <verify>Run `npm run build` - TypeScript compiles without errors. Check IDE shows JSDoc tooltips when hovering over new fields.</verify>
  <done>ReviewConfig interface includes intensityConsensusThresholds and intensitySeverityFilters with JSDoc documentation</done>
</task>

<task type="auto">
  <name>Task 3: Add Default Values</name>
  <files>src/config/defaults.ts</files>
  <action>
Add default values for the new intensity behavior fields. Add after the existing `intensityPromptDepth` block (around line 108):

```typescript
// Intensity consensus thresholds (percentage of providers that must agree)
intensityConsensusThresholds: {
  thorough: 80,  // 80% agreement for thorough review
  standard: 60,  // 60% agreement for standard review
  light: 40,     // 40% agreement for light review
},

// Intensity severity filters (minimum severity to show inline)
intensitySeverityFilters: {
  thorough: 'minor',   // Show all issues
  standard: 'minor',   // Show minor and above
  light: 'major',      // Only show major and critical
},
```

Values match roadmap success criteria:
- Phase 7: "Consensus filtering requires different agreement levels per intensity (thorough: 80%, standard: 60%, light: 40%)"
- Phase 7: "Severity filtering adjusts minimum inline threshold per intensity (thorough: info+, standard: minor+, light: major+)"

Note: Roadmap says "info+" for thorough but Severity type only has critical/major/minor. Use 'minor' as the lowest available severity.
  </action>
  <verify>Run `npm run build` - TypeScript compiles without errors. Run `npm test` - all existing tests pass.</verify>
  <done>DEFAULT_CONFIG includes intensityConsensusThresholds and intensitySeverityFilters with documented defaults</done>
</task>

</tasks>

<verification>
After all tasks:
1. `npm run build` succeeds
2. `npm test` passes (no regressions)
3. Schema accepts valid intensity behavior config
4. Types provide autocomplete in IDE
5. Defaults match roadmap success criteria values
</verification>

<success_criteria>
- [ ] intensity_consensus_thresholds in Zod schema with min(0).max(100) for each level
- [ ] intensity_severity_filters in Zod schema with severity enum for each level
- [ ] ReviewConfig interface has both new optional fields with JSDoc
- [ ] DEFAULT_CONFIG has defaults: consensus (80/60/40), severity (minor/minor/major)
- [ ] Build passes, tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-configuration-a-validation/06-01-SUMMARY.md`
</output>
