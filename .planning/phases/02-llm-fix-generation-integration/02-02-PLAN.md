---
phase: 02-llm-fix-generation-integration
plan: 02
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/utils/suggestion-sanity.ts
  - __tests__/unit/utils/suggestion-sanity.test.ts
autonomous: true

must_haves:
  truths:
    - "Empty suggestions are rejected"
    - "Excessively long suggestions (>50 lines) are rejected"
    - "Suggestions without code syntax are rejected"
    - "Valid suggestions pass validation"
    - "Validation returns structured result with reason on failure"
  artifacts:
    - path: "src/utils/suggestion-sanity.ts"
      provides: "Suggestion sanity validation function"
      exports: ["validateSuggestionSanity", "SuggestionSanityResult"]
    - path: "__tests__/unit/utils/suggestion-sanity.test.ts"
      provides: "Comprehensive test coverage for validation"
      min_lines: 50
  key_links:
    - from: "src/utils/suggestion-sanity.ts"
      to: "Finding.suggestion"
      via: "validation input"
      pattern: "validateSuggestionSanity"
---

<objective>
TDD: Create suggestion sanity validation function for basic quality checks

Purpose: Provide a reusable validation function that catches obvious red flags in LLM-generated suggestions before they enter the pipeline. This prevents garbage suggestions from being posted to GitHub.

Output: Working, tested validateSuggestionSanity function with comprehensive test coverage.
</objective>

<execution_context>
@/Users/keith/.claude/get-shit-done/workflows/execute-plan.md
@/Users/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-llm-fix-generation-integration/02-CONTEXT.md
@.planning/phases/02-llm-fix-generation-integration/02-RESEARCH.md
@src/utils/suggestion-formatter.ts
@src/utils/suggestion-validator.ts
</context>

<feature>
  <name>Suggestion Sanity Validation</name>
  <files>src/utils/suggestion-sanity.ts, __tests__/unit/utils/suggestion-sanity.test.ts</files>
  <behavior>
validateSuggestionSanity(suggestion: string | undefined | null): SuggestionSanityResult

Interface:
```typescript
interface SuggestionSanityResult {
  isValid: boolean;
  reason?: string;       // Present only when isValid is false
  suggestion?: string;   // Trimmed suggestion, present only when isValid is true
}
```

Cases (input -> expected output):
- undefined -> { isValid: false, reason: "No suggestion provided" }
- null -> { isValid: false, reason: "No suggestion provided" }
- "" -> { isValid: false, reason: "Empty suggestion" }
- "   " -> { isValid: false, reason: "Empty suggestion" }
- "const x = 1;" -> { isValid: true, suggestion: "const x = 1;" }
- "You should consider..." -> { isValid: false, reason: "Suggestion lacks code syntax" }
- (51+ lines of code) -> { isValid: false, reason: "Suggestion too long (>50 lines)" }
- "  const x = 1;  " -> { isValid: true, suggestion: "const x = 1;" } (trimmed)
- "if (user) {\n  return user.name;\n}" -> { isValid: true, suggestion: "if (user) {\n  return user.name;\n}" }

Code syntax indicators (any of these means it's code):
- Contains any of: { } ( ) [ ] ; = => -> : :: < >
- Regex: /[{}()\[\];=<>:]/
  </behavior>
  <implementation>
1. Create src/utils/suggestion-sanity.ts with:
   - SuggestionSanityResult interface (exported)
   - validateSuggestionSanity function (exported)

2. Validation logic (in order):
   a. Check for undefined/null -> reject with "No suggestion provided"
   b. Trim the suggestion
   c. Check for empty after trim -> reject with "Empty suggestion"
   d. Count lines (split by \n)
   e. If > 50 lines -> reject with "Suggestion too long (>50 lines)"
   f. Check for code syntax indicators -> if none, reject with "Suggestion lacks code syntax"
   g. Return valid with trimmed suggestion

3. This is Phase 2 "basic sanity checks" per CONTEXT.md:
   - NOT syntax validation (Phase 4)
   - NOT line number validation (already in suggestion-validator.ts)
   - Just catches obvious garbage
  </implementation>
</feature>

<verification>
TDD cycle verification:
1. RED: Tests written, all fail
2. GREEN: Implementation added, all pass
3. REFACTOR: Clean up if needed, tests still pass

Final verification:
```bash
npm test -- --testPathPattern=suggestion-sanity
npm run build
```
</verification>

<success_criteria>
1. All test cases pass
2. Function handles edge cases (undefined, null, whitespace)
3. Code syntax detection works for common patterns
4. Line count limit enforced
5. Returns structured result with reason on failure
6. Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/02-llm-fix-generation-integration/02-02-SUMMARY.md`
</output>
