name: Test

on:
  push: {}
  pull_request: {}
  workflow_dispatch: {}

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Shell syntax check
        run: bash -n action.sh
  smoke:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Ensure PyYAML present
        run: |
          python - <<'PY'
          import sys, subprocess
          try:
              import yaml  # type: ignore
          except Exception:
              subprocess.check_call([sys.executable, "-m", "pip", "install", "pyyaml==6.0.2"])
          PY
      - name: Config smoke tests
        run: python tests/config_smoke.py
  integration:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run integration budget test
        run: python tests/integration_budget.py
  unit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Inline consensus test
        run: python tests/inline_consensus_test.py
      - name: Provider validation test
        run: python tests/provider_validation_test.py
